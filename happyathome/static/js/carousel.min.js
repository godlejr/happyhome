/*!
 * Copyright Inotone Co., lTD.
 */
var Carousel=function(){var a=function(){this.fov=75,this.savedX=0,this.savedY=0,this.longitude=0,this.latitude=0,this.savedLongitude=0,this.savedLatitude=0,this.autoFlow=!0,this.isUserInteracting=!1};return a.prototype={viewer:function(a,b){var c=document.createElement("span"),d=document.createElement("span"),e=document.createElement("span"),f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div");c.classList.add("like-icon"),b.is_like&&c.classList.add("active"),d.classList.add("scrap-icon"),b.is_scrap&&d.classList.add("active"),e.classList.add("share-icon"),f.classList.add("content-like"),f.appendChild(c),g.appendChild(d),g.classList.add("content-scrap"),h.appendChild(e),h.classList.add("content-share"),this.photoWrap=document.getElementById(a),this.photoWrap.style.position="relative",b.action&&(this.photoWrap.appendChild(f),this.photoWrap.appendChild(g),this.photoWrap.appendChild(h)),this.canvasWidth=this.photoWrap.offsetWidth,this.canvasHeight=this.photoWrap.offsetHeight;var i=new THREE.SphereGeometry(500,60,40);i.applyMatrix((new THREE.Matrix4).makeScale(-1,1,1));var j=new THREE.TextureLoader;j.crossOrigin="";var k=new THREE.MeshBasicMaterial;k.map=j.load(b.panorama,function(a){},function(a){console.log(a.loaded/a.total*100+"% loaded")},function(a){console.log("An error happened")}),this.scene=new THREE.Scene,this.scene.add(new THREE.Mesh(i,k)),this.camera=new THREE.PerspectiveCamera(this.fov,this.canvasWidth/this.canvasHeight,1,1100),this.camera.target=new THREE.Vector3(0,0,0),this.renderer=new THREE.WebGLRenderer,this.renderer.setSize(this.canvasWidth,this.canvasHeight),this.photoWrap.appendChild(this.renderer.domElement),this.photoWrap.addEventListener("mouseup",this.onPhotoMouseUp.bind(this),!1),this.photoWrap.addEventListener("mousedown",this.onPhotoMouseDown.bind(this),!1),this.photoWrap.addEventListener("mousemove",this.onPhotoMouseMove.bind(this),!1),this.photoWrap.addEventListener("mousewheel",this.onPhotoMouseWheel.bind(this),!1),this.animate()},onPhotoMouseUp:function(a){this.isUserInteracting=!1},onPhotoMouseDown:function(a){a.preventDefault(),this.autoFlow=!1,this.isUserInteracting=!0,this.savedX=a.clientX,this.savedY=a.clientY,this.savedLongitude=this.longitude,this.savedLatitude=this.latitude},onPhotoMouseMove:function(a){this.isUserInteracting&&(this.longitude=.1*(this.savedX-a.clientX)+this.savedLongitude,this.latitude=.1*(a.clientY-this.savedY)+this.savedLatitude)},onPhotoMouseWheel:function(a){a.preventDefault(),a.wheelDeltaY?this.fov-=.05*a.wheelDeltaY:a.wheelDelta?this.fov-=.05*a.wheelDelta:a.detail&&(this.fov+=1*a.detail),this.fov<35?this.fov=35:this.fov>95&&(this.fov=95),this.camera.projectionMatrix.makePerspective(this.fov,this.canvasWidth/this.canvasHeight,1,1100),this.render()},animate:function(){this.render(),window.requestAnimationFrame(this.animate.bind(this))},render:function(){this.autoFlow&&(this.longitude+=.07),this.latitude=Math.max(-85,Math.min(85,this.latitude)),this.camera.target.x=500*Math.sin(THREE.Math.degToRad(90-this.latitude))*Math.cos(THREE.Math.degToRad(this.longitude)),this.camera.target.y=500*Math.cos(THREE.Math.degToRad(90-this.latitude)),this.camera.target.z=500*Math.sin(THREE.Math.degToRad(90-this.latitude))*Math.sin(THREE.Math.degToRad(this.longitude)),this.camera.lookAt(this.camera.target),this.renderer.render(this.scene,this.camera)}},a}();
