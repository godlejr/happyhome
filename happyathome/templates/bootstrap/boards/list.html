{% extends "bootstrap/boards/base.html" %}

{% block content %}
<div class="content">
    <div class="content-body">
        <div class="content-board">
            <div class="board-title">해피 Q&A</div>

            {% if session.user_id %}
            <div class="input-field">
                <form id="boardForm" method="POST" action="{{ url_for('boards.new', board_id=board_id) }}">
                    <textarea id="boardContent" name="board_content"></textarea><button type="submit">질문<br>하기</button>
                </form>
            </div>
            {% endif %}

            <div class="board-lists">
                {% for post in posts %}
                    <div class="board-list {% if post.depth %}reply{% endif %}" post-id="{{ post.id }}">
                        <div class="board-author">
                            {% if not post.is_reply %}
                                <strong>Q.</strong>
                            {% else %}
                                <strong>A.</strong>
                            {% endif %}
                            <span class="user-avatar" style="background-image:url({{ url_for_s3('S3_USER_DIRECTORY', filename=post.user.avatar) }})"></span>
                            <span class="user-name">{{ post.user.name }}</span>
                            <span class="board-date">{{ post.created_date }}</span>
                            {% if not post.is_reply and session.user_level > 1 %}
                                <span class="board-control">
                                    <a href="javascript:;" onclick="replyPost({{ post.id }}, this)">답변</a>
                                </span>
                            {% endif %}
                            {% if post.user_id == session.user_id %}
                                <span class="board-control">
                                    <a href="javascript:;" onclick="modify({{ post.id }})">수정</a>
                                    <a href="javascript:;" onclick="deletePost({{ post.id }})">삭제</a>
                                </span>
                            {% endif %}
                        </div>
                        <div class="board-content">{{ post.content }}</div>
                        <div class="board-content reply-form hide">
                            <form name="replyForm" method="POST" action="{{ url_for('boards.reply', board_id=board_id, post_id=post.id) }}">
                                <textarea name="reply_content"></textarea><button type="submit">답변<br>하기</button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <div class="pagination-nav">{{ func.render_pagination('boards.list', pagination, id=board_id) }}</div>
        </div>
    </div>
</div>

<script>
$('#boardForm').submit(function() {
    if (!$('#boardContent').val()) {
        alert('질문을 입력해주세요.');
        $('#boardContent').focus();
        return false;
    }

    return true;
});

function deletePost(post_id) {
    if (confirm("질문을 삭제하시겠습니까")) {
        document.location.href = "/board/{{ board_id }}/" + post_id + "/delete";
    }
}

function replyPost(post_id, obj) {
    var $replyForm = $('.board-list[post-id=' + post_id + '] .reply-form');

    if ($replyForm.css('display') === 'none') {
        $(obj).text('취소');
        $replyForm.show();
    } else {
        $(obj).text('답변');
        $replyForm.hide();
    }
}
</script>
{% endblock %}
