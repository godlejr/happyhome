{% extends 'bootstrap/users/base.html' %}

{% block content%}
<div class="content">
    <div class="users-hp" id="{{ post.id }}"
         {% if post.cover %}
         style="background-image:url( {{ current_app.config['S3_BUCKET_NAME'] + current_app.config['S3_COVER_DIRECTORY'] + post.cover }} )"
         {% else %}
         style="background-image:url( {{ current_app.config['S3_BUCKET_NAME'] + current_app.config['S3_COVER_DIRECTORY'] + current_app.config['NO_IMG'] }} )"
         {% endif %}>
        <div class="users-hp-info">
            <div class="users-hp-avatar-info">
                <div class="users-hp-avatar" {% if post.avatar %}
                     style="background-image:url( {{ current_app.config['S3_BUCKET_NAME'] + current_app.config['S3_USER_DIRECTORY'] + post.avatar }} )"
                     {% else %}
                     style="background-image:url( {{ current_app.config['S3_BUCKET_NAME'] + current_app.config['S3_COVER_DIRECTORY'] + current_app.config['NO_IMG'] }} )"
                     {% endif %}>
                </div>
                <div class="users-hp-review">
                    review *****
                </div>
            </div>
            <div class="users-hp-company-info">
                <div class="users-hp-company-name">
                    {{ post.name }}
                </div>
                <div class="users-hp-company-follow">
                    팔로우 팔로워
                </div>
            </div>
            {% if session.user_id %}
                {%if session.user_id == post.id %}
                <div class="users-hp-profile-edit">
                    <div class="users-hp-pofile-editbutton"><a href="{{ url_for('users.edit_info',id=post.id) }}">프로필 수정</a></div>
                </div>
                {% else %}
                    {% if not post.follow_check(session.user_id ,post.id) %}
                    <div class="users-hp-profile-edit" id="follow">
                        <div class="users-hp-pofile-editbutton">팔로우</div>
                    </div>
                    {% else %}
                    <div class="users-hp-profile-edit" id="follow_cancel">
                        <div class="users-hp-pofile-editbutton">팔로우 취소</div>
                    </div>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>
    </div>

    <div class="users-hp-button-list">
        <ul class="users-hp-menu">
            {{ func.render_sub_hp_menu('users.gallery', '갤러리',post.id) }}
            {{ func.render_sub_hp_menu('users.detail_list', '스토리',post.id) }}
            {{ func.render_sub_hp_menu('professionals.list', '스크랩') }}
            {{ func.render_sub_hp_menu('users.detail_qna', 'Q&A',post.id) }}
             {{ func.render_sub_hp_menu('professionals.list', '리뷰') }}
        </ul>
    </div>
   {% block content_body %}{% endblock %}
</div>

<script>
    $("#follow").click(function(){
        $(this).replaceWith('<div class="users-hp-profile-edit" id="temper_follow_cancel">'+'<div class="users-hp-pofile-editbutton">팔로우 취소</div>'+'</div>');
        follow();
    });

    $("#follow_cancel").click(function(){
        $(this).replaceWith('<div class="users-hp-profile-edit" id="temper_follow">'+'<div class="users-hp-pofile-editbutton">팔로우</div>'+'</div>');
        follow_cancel();
    });

    $("#temper_follow").click(function(){
        $(this).replaceWith('<div class="users-hp-profile-edit" id="temper_follow_cancel">'+'<div class="users-hp-pofile-editbutton">팔로우 취소</div>'+'</div>');
        follow();
    });

    $("#temper_follow_cancel").click(function(){
        $(this).replaceWith('<div class="users-hp-profile-edit" id="temper_follow">'+'<div class="users-hp-pofile-editbutton">팔로우</div>'+'</div>');
        follow_cancel();
    });

    function follow(){
         $.ajax({
                type: "POST",
                url: "{{ url_for('users.following') }}",
                data: {
                    user_id: "{{ session.user_id }}",
                    follow_id: "{{ post.id }}"
                }
            }).fail(function() {
                $("#temper_follow_cancel").replaceWith('<div class="users-hp-profile-edit" id="temper_follow">'+'<div class="users-hp-pofile-editbutton">팔로우</div>'+'</div>');
            });
    }

    function follow_cancel(){
         $.ajax({
                type: "POST",
                url: "{{ url_for('users.following_cancel') }}",
                data: {
                    user_id: "{{ session.user_id }}",
                    follow_id: "{{ post.id }}"
                }
            }).fail(function() {
                 $("#temper_follow").replaceWith('<div class="users-hp-profile-edit" id="temper_follow_cancel">'+'<div class="users-hp-pofile-editbutton">팔로우 취소</div>'+'</div>');
            });
    }


</script>
{% endblock %}