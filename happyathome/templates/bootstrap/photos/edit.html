{% extends 'bootstrap/photos/base.html' %}

{% block content %}
<div class="cards">
    <div class="well bs-component">
        <form method="POST" class="form-horizontal" enctype="multipart/form-data">
            <fieldset>
                <legend>사진을 등록해주세요.</legend>

                <div class="form-group">
                    <div id="photoPreview">
                        <span class="glyphicon glyphicon-open"></span>
                    </div>
                    <input type="file" id="photoFile" name="photo_file" />
                </div>

                <div class="form-group">
                    <div class="col-lg-10 col-lg-offset-1">
                        <textarea class="form-control" rows="5" id="textArea" name="content" placeholder="사진에 대한 설명을 등록해주세요."></textarea>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-lg-10 col-lg-offset-1">
                        <button type="reset" class="btn btn-default">취소</button>
                        <button type="submit" class="btn btn-primary">등록</button>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
</div>

<script>
var $photoFile = $('#photoFile'),
    $photoPreview = $('#photoPreview');

$photoPreview.click(function(e) {
    e.preventDefault();

    $photoFile.click();
});

$photoFile.change(function() {
    $photoPreview.children().remove();

    var ext = $(this).val().split('.').pop().toLowerCase();
    if (ext.length > 0) {
        if ($.inArray(ext, ['gif', 'png', 'jpg', 'jpeg']) == -1) {
            alert('사진 파일(gif, png, jpg)만 업로드 할수 있습니다.');
            $(this).val('');
            return false;
        }
    }
    loadPhoto($photoPreview[0], $photoFile[0]);
});

function loadPhoto(photoPreview, dataURL) {
    var reader = new FileReader();

    reader.readAsDataURL(dataURL.files[0]);
    reader.onload = function (e) {
        var img = new Image();
        img.src = e.target.result;
        img.height = photoPreview.offsetHeight;
        img.onload = function() {
            photoPreview.appendChild(this);
            photoPreview.style.width = photoPreview.offsetHeight * (this.width / this.height);
        };
    }
}
</script>
{% endblock %}
