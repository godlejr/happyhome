{% extends 'admin/master.html' %}
{% block body %}
<link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
<div class="content">
    <div class="content-body">
        <div class="content-board">
            <div class="board-title">해피홈, 기간별 통계</div>
            <div class="status-content" >
                <div id="chartContainer" style="height: 300px; width: 100%;"></div>
            </div>
        </div>

        <div class="content-board">
            <div class="board-title">컨텐츠 누적통계</div>
            <div class="status-content" >
                <table class="content-table">
                    <tr>
                        <td>
                            <div class="sub-title">스토리 컨텐츠 현황</div>
                        </td>
                        <td>
                            <div class="sub-title">갤러리 컨텐츠 현황</div>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <table class="table table-striped">
                                <tr>
                                    <th>카테고리</th>
                                    <th>개수</th>
                                </tr>
                                {% for category in categories %}
                                <tr>
                                    <td>{{category.name}}</td>
                                    <td>{{category.get_count(category.id)}}</td>
                                </tr>
                                {% endfor %}
                                <tr>
                                    <td>합계</td>
                                    <td>{{categories_sum}}</td>
                                </tr>
                            </table>
                        </td>
                        <td>
                            <table class="table table-striped">
                                <tr>
                                    <th>공간</th>
                                    <th>개수</th>
                                </tr>
                                {% for room in rooms %}
                                <tr>
                                    <td>{{room.name}}</td>
                                    <td>{{room.get_count(room.id)}}</td>
                                </tr>
                                {% endfor %}
                                <tr>
                                    <td>합계</td>
                                    <td>{{rooms_sum}}</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                  </table>
                <table class="content-table">
                    <tr>
                        <td>
                            <div class="sub-title">회원수</div>
                        </td>
                        <td>
                            <div class="sub-title">전문가 컨텐츠 현황</div>
                        </td>
                        <td>
                            <div class="sub-title">해피 Q&A 현황</div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <table class="table table-striped">
                                <tr>
                                    <th>회원</th>
                                    <th>인원수</th>
                                </tr>
                                <tr>
                                    <td>개인 회원</td>
                                    <td>{{ user_count }}</td>
                                </tr>
                                <tr>
                                    <td>업체 회원</td>
                                    <td>{{ pro_count }}</td>
                                </tr>
                                <tr>
                                    <td>합계</td>
                                    <td>{{pro_count+user_count}}</td>
                                </tr>
                            </table>
                        </td>
                        <td>
                            <table class="table table-striped">
                                <tr>
                                    <th>컨텐츠</th>
                                    <th>개수</th>
                                </tr>
                                <tr>
                                    <td>스토리</td>
                                    <td>{{pro_story_count}}</td>
                                </tr>
                                <tr>
                                    <td>갤러리</td>
                                    <td>{{pro_gallery_count}}</td>
                                </tr>
                                <tr>
                                    <td>합계</td>
                                    <td>{{pro_story_count+pro_gallery_count}}</td>
                                </tr>
                            </table>
                        </td>
                        <td>
                            <table class="table table-striped">
                                <tr>
                                    <th>유형</th>
                                    <th>개수</th>
                                </tr>
                                <tr>
                                    <td>질의</td>
                                    <td>{{board_question_total}}</td>
                                </tr>
                                <tr>
                                    <td>답변</td>
                                    <td>{{board_answer_total}}</td>
                                </tr>
                                <tr>
                                    <td>합계</td>
                                    <td>{{board_question_total+board_answer_total}}</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
        </div>
    </div>
</div>
</div>

<script src="http://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script>
window.onload = function () {
        CanvasJS.addCultureInfo("ko",
            {
              decimalSeparator: ",",// Observe ToolTip Number Format
              digitGroupSeparator: ".", // Observe axisY labels
              days: ["일", "월", "화", "수", "목", "금", "토"],
              shortMonths: ["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"]
            });

		var chart = new CanvasJS.Chart("chartContainer",
		{
            culture:"ko",
			title:{
				text: "주간 회원 통계",
				fontSize: 15
			},
            animationEnabled: true,
			axisX:{
				gridColor: "Silver",
				tickColor: "silver",
				valueFormatString: "MM/DD"
			},
            toolTip:{
                shared:true
            },
			theme: "theme1",
			axisY: {
				gridColor: "Silver",
				tickColor: "silver"
			},
			legend:{
				verticalAlign: "center",
				horizontalAlign: "right"
			},
			data: [
			{   name: "누적 회원수",
				type: "line",
				showInLegend: true,
				lineThickness: 2,
				markerType: "square",
				color: "#F08080",
				dataPoints: [
                    {% for daily_user in daily_users %}
                        { x: new Date({{ daily_user.year|int }},{{ daily_user.month|int -1 }},{{ daily_user.day|int }}), y: {{ minus_user[loop.index-1] }} },
                    {% endfor %}
				]
			},
			{   name:"일별 가입 회원수",
				type: "line",
				showInLegend: true,
				color: "#20B2AA",
				lineThickness: 2,

				dataPoints: [
				    {% for join_user in join_users %}
                        { x: new Date({{ join_user.year|int }},{{ join_user.month|int -1 }},{{ join_user.day|int }}), y: {{ join_user.user_count|int }} },
                    {% endfor %}
				]
			}
			],
          legend:{
            cursor:"pointer",
            itemclick:function(e){
              if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
              	e.dataSeries.visible = false;
              }
              else{
                e.dataSeries.visible = true;
              }
              chart.render();
            }
          }
		});

chart.render();
}

</script>
{% endblock body %}